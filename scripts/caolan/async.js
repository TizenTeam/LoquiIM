(function(){var s={};var t,previous_async;t=this;if(t!=null){previous_async=t.async}s.noConflict=function(){t.async=previous_async;return s};function only_once(a){var b=false;return function(){if(b)throw new Error("Callback was already called.");b=true;a.apply(t,arguments)}}var u=function(a,b){if(a.forEach){return a.forEach(b)}for(var i=0;i<a.length;i+=1){b(a[i],i,a)}};var w=function(b,c){if(b.map){return b.map(c)}var d=[];u(b,function(x,i,a){d.push(c(x,i,a))});return d};var z=function(b,c,d){if(b.reduce){return b.reduce(c,d)}u(b,function(x,i,a){d=c(d,x,i,a)});return d};var A=function(a){if(Object.keys){return Object.keys(a)}var b=[];for(var k in a){if(a.hasOwnProperty(k)){b.push(k)}}return b};if(typeof process==='undefined'||!(process.nextTick)){if(typeof setImmediate==='function'){s.setImmediate=setImmediate;s.nextTick=setImmediate}else{s.nextTick=function(a){setTimeout(a,0)};s.setImmediate=s.nextTick}}else{s.nextTick=process.nextTick;if(typeof setImmediate!=='undefined'){s.setImmediate=setImmediate}else{s.setImmediate=s.nextTick}}s.each=function(b,c,d){d=d||function(){};if(!b.length){return d()}var e=0;u(b,function(x){c(x,only_once(function(a){if(a){d(a);d=function(){}}else{e+=1;if(e>=b.length){d(null)}}}))})};s.forEach=s.each;s.eachSeries=function(b,c,d){d=d||function(){};if(!b.length){return d()}var e=0;var f=function(){c(b[e],function(a){if(a){d(a);d=function(){}}else{e+=1;if(e>=b.length){d(null)}else{f()}}})};f()};s.forEachSeries=s.eachSeries;s.eachLimit=function(a,b,c,d){var e=B(b);e.apply(null,[a,c,d])};s.forEachLimit=s.eachLimit;var B=function(h){return function(b,c,d){d=d||function(){};if(!b.length||h<=0){return d()}var e=0;var f=0;var g=0;(function replenish(){if(e>=b.length){return d()}while(g<h&&f<b.length){f+=1;g+=1;c(b[f-1],function(a){if(a){d(a);d=function(){}}else{e+=1;g-=1;if(e>=b.length){d()}else{replenish()}}})}})()}};var C=function(b){return function(){var a=Array.prototype.slice.call(arguments);return b.apply(null,[s.each].concat(a))}};var D=function(b,c){return function(){var a=Array.prototype.slice.call(arguments);return c.apply(null,[B(b)].concat(a))}};var E=function(b){return function(){var a=Array.prototype.slice.call(arguments);return b.apply(null,[s.eachSeries].concat(a))}};var F=function(c,d,e,f){var g=[];d=w(d,function(x,i){return{index:i,value:x}});c(d,function(x,b){e(x.value,function(a,v){g[x.index]=v;b(a)})},function(a){f(a,g)})};s.map=C(F);s.mapSeries=E(F);s.mapLimit=function(a,b,c,d){return G(b)(a,c,d)};var G=function(a){return D(a,F)};s.reduce=function(c,d,e,f){s.eachSeries(c,function(x,b){e(d,x,function(a,v){d=v;b(a)})},function(a){f(a,d)})};s.inject=s.reduce;s.foldl=s.reduce;s.reduceRight=function(a,b,c,d){var e=w(a,function(x){return x}).reverse();s.reduce(e,b,c,d)};s.foldr=s.reduceRight;var H=function(d,e,f,g){var h=[];e=w(e,function(x,i){return{index:i,value:x}});d(e,function(x,a){f(x.value,function(v){if(v){h.push(x)}a()})},function(c){g(w(h.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};s.filter=C(H);s.filterSeries=E(H);s.select=s.filter;s.selectSeries=s.filterSeries;var I=function(d,e,f,g){var h=[];e=w(e,function(x,i){return{index:i,value:x}});d(e,function(x,a){f(x.value,function(v){if(!v){h.push(x)}a()})},function(c){g(w(h.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};s.reject=C(I);s.rejectSeries=E(I);var J=function(c,d,e,f){c(d,function(x,b){e(x,function(a){if(a){f(x);f=function(){}}else{b()}})},function(a){f()})};s.detect=C(J);s.detectSeries=E(J);s.some=function(b,c,d){s.each(b,function(x,a){c(x,function(v){if(v){d(true);d=function(){}}a()})},function(a){d(false)})};s.any=s.some;s.every=function(b,c,d){s.each(b,function(x,a){c(x,function(v){if(!v){d(false);d=function(){}}a()})},function(a){d(true)})};s.all=s.every;s.sortBy=function(h,i,j){s.map(h,function(x,c){i(x,function(a,b){if(a){c(a)}else{c(null,{value:x,criteria:b})}})},function(e,f){if(e){return j(e)}else{var g=function(c,d){var a=c.criteria,b=d.criteria;return a<b?-1:a>b?1:0};j(null,w(f.sort(g),function(x){return x.value}))}})};s.auto=function(j,l){l=l||function(){};var m=A(j);if(!m.length){return l(null)}var n={};var o=[];var p=function(a){o.unshift(a)};var q=function(a){for(var i=0;i<o.length;i+=1){if(o[i]===a){o.splice(i,1);return}}};var r=function(){u(o.slice(0),function(a){a()})};p(function(){if(A(n).length===m.length){l(null,n);l=function(){}}});u(m,function(k){var e=(j[k]instanceof Function)?[j[k]]:j[k];var f=function(b){var c=Array.prototype.slice.call(arguments,1);if(c.length<=1){c=c[0]}if(b){var d={};u(A(n),function(a){d[a]=n[a]});d[k]=c;l(b,d);l=function(){}}else{n[k]=c;s.setImmediate(r)}};var g=e.slice(0,Math.abs(e.length-1))||[];var h=function(){return z(g,function(a,x){return(a&&n.hasOwnProperty(x))},true)&&!n.hasOwnProperty(k)};if(h()){e[e.length-1](f,n)}else{var i=function(){if(h()){q(i);e[e.length-1](f,n)}};p(i)}})};s.waterfall=function(e,f){f=f||function(){};if(e.constructor!==Array){var g=new Error('First argument to waterfall must be an array of functions');return f(g)}if(!e.length){return f()}var h=function(d){return function(a){if(a){f.apply(null,arguments);f=function(){}}else{var b=Array.prototype.slice.call(arguments,1);var c=d.next();if(c){b.push(h(c))}else{b.push(f)}s.setImmediate(function(){d.apply(null,b)})}}};h(s.iterator(e))()};var K=function(e,f,g){g=g||function(){};if(f.constructor===Array){e.map(f,function(c,d){if(c){c(function(a){var b=Array.prototype.slice.call(arguments,1);if(b.length<=1){b=b[0]}d.call(null,a,b)})}},g)}else{var h={};e.each(A(f),function(k,c){f[k](function(a){var b=Array.prototype.slice.call(arguments,1);if(b.length<=1){b=b[0]}h[k]=b;c(a)})},function(a){g(a,h)})}};s.parallel=function(a,b){K({map:s.map,each:s.each},a,b)};s.parallelLimit=function(a,b,c){K({map:G(b),each:B(b)},a,c)};s.series=function(e,f){f=f||function(){};if(e.constructor===Array){s.mapSeries(e,function(c,d){if(c){c(function(a){var b=Array.prototype.slice.call(arguments,1);if(b.length<=1){b=b[0]}d.call(null,a,b)})}},f)}else{var g={};s.eachSeries(A(e),function(k,c){e[k](function(a){var b=Array.prototype.slice.call(arguments,1);if(b.length<=1){b=b[0]}g[k]=b;c(a)})},function(a){f(a,g)})}};s.iterator=function(c){var d=function(a){var b=function(){if(c.length){c[a].apply(null,arguments)}return b.next()};b.next=function(){return(a<c.length-1)?d(a+1):null};return b};return d(0)};s.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};var L=function(c,d,e,f){var r=[];c(d,function(x,b){e(x,function(a,y){r=r.concat(y||[]);b(a)})},function(a){f(a,r)})};s.concat=C(L);s.concatSeries=E(L);s.whilst=function(b,c,d){if(b()){c(function(a){if(a){return d(a)}s.whilst(b,c,d)})}else{d()}};s.doWhilst=function(b,c,d){b(function(a){if(a){return d(a)}if(c()){s.doWhilst(b,c,d)}else{d()}})};s.until=function(b,c,d){if(!b()){c(function(a){if(a){return d(a)}s.until(b,c,d)})}else{d()}};s.doUntil=function(b,c,d){b(function(a){if(a){return d(a)}if(!c()){s.doUntil(b,c,d)}else{d()}})};s.queue=function(f,g){if(g===undefined){g=1}function _insert(q,c,d,e){if(c.constructor!==Array){c=[c]}u(c,function(a){var b={data:a,callback:typeof e==='function'?e:null};if(d){q.tasks.unshift(b)}else{q.tasks.push(b)}if(q.saturated&&q.tasks.length===g){q.saturated()}s.setImmediate(q.process)})}var h=0;var q={tasks:[],concurrency:g,saturated:null,empty:null,drain:null,push:function(a,b){_insert(q,a,false,b)},unshift:function(a,b){_insert(q,a,true,b)},process:function(){if(h<q.concurrency&&q.tasks.length){var a=q.tasks.shift();if(q.empty&&q.tasks.length===0){q.empty()}h+=1;var b=function(){h-=1;if(a.callback){a.callback.apply(a,arguments)}if(q.drain&&q.tasks.length+h===0){q.drain()}q.process()};var c=only_once(b);f(a.data,c)}},length:function(){return q.tasks.length},running:function(){return h}};return q};s.cargo=function(e,f){var g=false,tasks=[];var h={tasks:tasks,payload:f,saturated:null,empty:null,drain:null,push:function(b,c){if(b.constructor!==Array){b=[b]}u(b,function(a){tasks.push({data:a,callback:typeof c==='function'?c:null});if(h.saturated&&tasks.length===f){h.saturated()}});s.setImmediate(h.process)},process:function process(){if(g)return;if(tasks.length===0){if(h.drain)h.drain();return}var c=typeof f==='number'?tasks.splice(0,f):tasks.splice(0);var d=w(c,function(a){return a.data});if(h.empty)h.empty();g=true;e(d,function(){g=false;var b=arguments;u(c,function(a){if(a.callback){a.callback.apply(null,b)}});process()})},length:function(){return tasks.length},running:function(){return g}};return h};var M=function(e){return function(c){var d=Array.prototype.slice.call(arguments,1);c.apply(null,d.concat([function(a){var b=Array.prototype.slice.call(arguments,1);if(typeof console!=='undefined'){if(a){if(console.error){console.error(a)}}else if(console[e]){u(b,function(x){console[e](x)})}}}]))}};s.log=M('log');s.dir=M('dir');s.memoize=function(d,e){var f={};var g={};e=e||function(x){return x};var h=function(){var a=Array.prototype.slice.call(arguments);var b=a.pop();var c=e.apply(null,a);if(c in f){b.apply(null,f[c])}else if(c in g){g[c].push(b)}else{g[c]=[b];d.apply(null,a.concat([function(){f[c]=arguments;var q=g[c];delete g[c];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,arguments)}}]))}};h.memo=f;h.unmemoized=d;return h};s.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}};s.times=function(a,b,c){var d=[];for(var i=0;i<a;i++){d.push(i)}return s.map(d,b,c)};s.timesSeries=function(a,b,c){var d=[];for(var i=0;i<a;i++){d.push(i)}return s.mapSeries(d,b,c)};s.compose=function(){var i=Array.prototype.reverse.call(arguments);return function(){var f=this;var g=Array.prototype.slice.call(arguments);var h=g.pop();s.reduce(i,g,function(c,d,e){d.apply(f,c.concat([function(){var a=arguments[0];var b=Array.prototype.slice.call(arguments,1);e(a,b)}]))},function(a,b){h.apply(f,[a].concat(b))})}};var N=function(f,g){var h=function(){var c=this;var d=Array.prototype.slice.call(arguments);var e=d.pop();return f(g,function(a,b){a.apply(c,d.concat([b]))},e)};if(arguments.length>2){var i=Array.prototype.slice.call(arguments,2);return h.apply(this,i)}else{return h}};s.applyEach=C(N);s.applyEachSeries=E(N);s.forever=function(b,c){function next(a){if(a){if(c){return c(a)}throw a;}b(next)}next()};if(typeof define!=='undefined'&&define.amd){define([],function(){return s})}else if(typeof module!=='undefined'&&module.exports){module.exports=s}else{t.async=s}}());
